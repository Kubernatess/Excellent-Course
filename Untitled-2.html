<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>无标题文档</title>
<script>
window.onload=function(){
	var ul=document.getElementsByTagName('ul')[1];
	var button=document.getElementsByTagName('button')[0];
	var currentNode=null;
	var menu=document.getElementById('contextmenu');
	
	button.onclick=function(){
		var liNode=document.createElement('li');
		var spanNode=document.createElement('span');
		var signNode=document.createTextNode("▶");
		var textNode=document.createTextNode("新增子栏目");
		// 添加子栏目
		spanNode.appendChild(signNode);
		liNode.appendChild(spanNode);
		liNode.appendChild(textNode);
		ul.appendChild(liNode);	
		// 并指向当前节点
		currentNode=liNode;
		// 添加右键事件
		liNode.oncontextmenu=function(){
			popMenu(this);
		};
		// 添加点击事件
		liNode.onclick=function(){
			handle(this);
		};
	};
	
	// 在栏目范围外,右键隐藏菜单
    document.onclick = function(){
		menu.style.display='none';
    }
	
	function popMenu(column){
		// 右键执行一次点击事件处理
		handle(column);
		//阻止默认行为
		var ev = ev || event;
		ev.preventDefault();
		//记录当前的坐标(x轴和y轴)
		var x = ev.clientX;
		var y = ev.clientY;		
		menu.style.display = 'block';//右键点击时显示菜单框
		menu.style.left = x + 'px';
		menu.style.top = y + 'px';
	};
	
	function handle(node){
		// 每次点击时把该节点指向当前节点
		currentNode=node;
		// 获取所有栏目节点
		var li=ul.getElementsByTagName('li');
		// 对其他栏目设置默认样式
		for(var i=0;i<li.length;i++){
			li[i].style.backgroundColor="#FFF";
			// 添加索引值
			li[i].index=i;
		};
		// 给当前栏目设置样式
		node.style.backgroundColor="#d2d3d561";
	};
};
</script>
<style>
ul li {
	list-style-type: none;
	backgroundColor:#d2d3d561;
}
#contextmenu {
	position:absolute;
    background-color:#f9f9f9;
    width:150px;
    box-shadow:0px 8px 16px rgba(0,0,0,0.2);
	z-index:1;
	padding:0;
	display:none;
}

/*定义下拉内容的样式*/
#contextmenu>li {
    color:black;
    padding:12px 16px;
}
/*定义下拉内容悬停时的样式*/
#contextmenu>li:hover {
	background-color: #f1f1f1
}
</style>
</head>

<body>
<ul id="contextmenu">
<li>添加栏目</li>
<li>添加子栏目</li>
<li>删除该栏目</li>
<li>上移</li>
<li>下移</li>
</ul>

<ul>
<li><span>▶</span>添加子栏目</li>
<li><span>▶</span>添加子栏目</li>
<li><span>▶</span>添加子栏目</li>
<li>
	<ul>
    	<li><span>▶</span>添加子栏目</li>
		<li><span>▶</span>添加子栏目</li>
		<li><span>▶</span>添加子栏目</li>
    </ul>
</li>
</ul>
<button type="button"><img src="image/add.png" title="添加子栏目"></button>
</body>
</html>
